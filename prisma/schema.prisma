generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// model User {
//   id       Int       @id @default(autoincrement())
//   email    String    @unique
//   username String    @unique
//   password String
// }

enum Role {
  USER
  ADMIN
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  name           String?
  password       String    // Hashé bien sûr
  role           Role      @default(USER)
  xp             Int       @default(0)
  
  // Relations
  unlockedSkills UserSkill[]
  completedChallenges UserChallenge[]
  
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model Roadmap {
  id          String   @id @default(cuid())
  slug        String   @unique // ex: "languages", "sciences" (identifiant URL)
  title       String
  description String?
  
  skills      Skill[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Skill {
  id          String   @id @default(cuid())
  slug        String   // L'ID utilisé dans le front (ex: "l-basics")
  
  roadmapId   String
  roadmap     Roadmap  @relation(fields: [roadmapId], references: [id])
  
  label       String
  description String?
  content     String?  @db.Text // Le contenu HTML de la leçon
  xp          Int      @default(50)
  
  // Coordonnées pour ReactFlow
  positionX   Float
  positionY   Float
  
  // Auto-relation pour les arêtes (Edges)
  // Une compétence peut avoir des prérequis (parents) et débloquer d'autres compétences (enfants)
  prerequisites Skill[] @relation("SkillPrerequisites")
  enabledBy     Skill[] @relation("SkillPrerequisites")
  
  unlockedBy    UserSkill[]

  // Unicité du slug au sein d'une roadmap
  @@unique([roadmapId, slug])
}

model UserSkill {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  skillId   String
  skill     Skill    @relation(fields: [skillId], references: [id])
  
  unlockedAt DateTime @default(now())
  
  @@unique([userId, skillId])
}

model Challenge {
  id          String     @id @default(cuid())
  title       String
  description String
  difficulty  Difficulty
  xp          Int
  tags        String[]
  
  completedBy UserChallenge[]
}

model UserChallenge {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  
  challengeId String
  challenge   Challenge @relation(fields: [challengeId], references: [id])
  
  completedAt DateTime  @default(now())
  
  @@unique([userId, challengeId])
}